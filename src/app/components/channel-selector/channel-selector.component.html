<div class="channel-selector">
  <!-- Floating button removed in favor of top menu -->

  <!-- Side Menu (Remote Body) -->
  <div class="menu-overlay" [class.hidden]="!isMenuOpen()" (click)="toggleMenu()"></div>
  <div class="side-menu vintage-texture-bg" [class.open]="isMenuOpen()" (click)="$event.stopPropagation()">

    <!-- Vintage Header -->
    <div class="remote-header">
      <div class="brand-logo-container">
        <div class="logo-wrapper">
          <img [src]="easterEggService.isUnlocked() ? 'images/nmtv-logo-old.png' : 'images/nmtv-logo.png'" alt="NMTV" class="brand-logo" (click)="onLogoClick()"
            [attr.tabindex]="isMenuOpen() ? 0 : -1" (keydown.enter)="onLogoClick()"
            [class.clickable]="easterEggService.isUnlocked()">

          @if (isLoadingNoa()) {
          <div class="loading-indicator">
            <i class="bi bi-arrow-clockwise spinner"></i>
          </div>
          } @else if (isNoaChannelReady()) {
          <span class="easter-egg-indicator">üêº</span>
          }
        </div>
      </div>
      <div class="power-off-container">
        <div class="green-dot"></div>
        <button class="power-off-button retro-round-button" (click)="turnOff()" [attr.tabindex]="isMenuOpen() ? 0 : -1"
          aria-label="Power off TV">
          <i class="bi bi-power" aria-hidden="true"></i>
        </button>
        <span class="power-off-text">Power</span>
      </div>

      <span class="model-text" (click)="onStereoClick()" [attr.tabindex]="isMenuOpen() ? 0 : -1"
        (keydown.enter)="onStereoClick()">STEREO SOUND</span>
    </div>

    @if (isSpecialChannelEnabled()) {
    <div class="special-broadcast-slot">
      <button class="special-event-button retro-button" (click)="onSpecialChannelClick()"
        [attr.tabindex]="isMenuOpen() ? 0 : -1">
        <div class="special-content">
          <span class="special-icon">{{ getSpecialEventIcon1() }}</span>
          <span class="special-text">{{ getSpecialEventLabel() }}</span>
          <span class="special-icon">{{ getSpecialEventIcon2() }}</span>
        </div>
        <div class="scanlines-overlay"></div>
      </button>
    </div>
    }

    <div class="channel-list retro-inset-panel">
      @for (channel of channels(); track channel.id) {
      <button class="channel-item retro-button" [class.active]="isActive(channel.id)"
        (click)="selectChannel(channel.id)" [attr.tabindex]="isMenuOpen() ? 0 : -1">
        <span class="channel-icon">{{ channel.icon }}</span>
        <span class="channel-name">{{ channel.name }}</span>
      </button>
      }
    </div>

    <div class="menu-actions">
      <button class="settings-button retro-button" (click)="openSettings()" [attr.tabindex]="isMenuOpen() ? 0 : -1">
        <i class="bi bi-tools settings-icon" aria-hidden="true"></i>
        <span class="settings-text">Mix Master</span>
      </button>
      <button class="about-button retro-button" (click)="openAbout()" [attr.tabindex]="isMenuOpen() ? 0 : -1">
        <i class="bi bi-lightbulb about-icon" aria-hidden="true"></i>
        <span class="about-text">About NMTV</span>
      </button>

      <button class="old-tv-button retro-button" (click)="toggleOldTV()" [class.active]="oldTVEnabled()"
        [attr.tabindex]="isMenuOpen() ? 0 : -1">
        <div class="toggle-content">
          <i class="bi bi-magic old-tv-icon"></i>
          <span class="old-tv-text">VCR Mode</span>
        </div>
        <div class="toggle-switch">
          <div class="toggle-track">
            <div class="toggle-thumb"></div>
          </div>
        </div>
      </button>

      @if (shouldShowFullScreen()) {
      <button class="fullscreen-button retro-button" (click)="toggleFullscreen()" [class.active]="isFullscreen()"
        [attr.tabindex]="isMenuOpen() ? 0 : -1">
        <div class="toggle-content">
          <i class="bi bi-arrows-fullscreen fullscreen-icon"></i>
          <span class="fullscreen-text">Fullscreen</span>
        </div>
        <div class="toggle-switch">
          <div class="toggle-track">
            <div class="toggle-thumb"></div>
          </div>
        </div>
      </button>
      }
    </div>

    <div class="d-pad-actions-container">
      <button class="support-button retro-small-button" (click)="openSupport()" [attr.tabindex]="isMenuOpen() ? 0 : -1"
        aria-label="Support NMTV">
        <i class="bi bi-cup-hot-fill" aria-hidden="true"></i>
        <span>Support</span>
      </button>

      @if (!isAndroidTV()) {
      @if (showInstallButton()) {
      <button class="install-button retro-small-button" (click)="installApp()" [attr.tabindex]="isMenuOpen() ? 0 : -1"
        aria-label="Install NMTV app">
        <i class="bi bi-download" aria-hidden="true"></i>
        <span>App</span>
      </button>
      }
      <button class="share-button retro-small-button" (click)="shareApp()" [attr.tabindex]="isMenuOpen() ? 0 : -1"
        aria-label="Share NMTV">
        <i class="bi bi-share-fill" aria-hidden="true"></i>
        <span>Share</span>
      </button>
      }
    </div>
  </div>

  <!-- Modals -->
  <app-settings-modal></app-settings-modal>
  <app-about-modal></app-about-modal>
  <app-install-modal></app-install-modal>
  <app-support-modal></app-support-modal>
</div>